# minihost TODO

## Completed

- [x] **MIDI input** - Add API to send MIDI events to plugins (notes, CC, pitch bend)
- [x] **MIDI output** - Capture MIDI generated by plugins (arpeggiators, MIDI effects)
- [x] **State save/load** - Save and restore plugin state for presets and session recall
- [x] **Parameter metadata** - Get parameter names, labels, units, and display strings
- [x] **Transport info** - Provide BPM, time signature, playhead position for tempo-synced plugins
- [x] **Tail time** - Query and handle plugin tail (reverbs, delays) after input stops
- [x] **Bypass** - Standard bypass functionality
- [x] **Parameter enumeration** - List all parameters with their ranges and properties
- [x] **Latency compensation** - Use reported latency for proper alignment
- [x] **Sample-accurate automation** - Parameter changes at specific sample positions within a block
- [x] **Thread safety** - Locking for parameter changes from non-audio threads
- [x] **Reset** - Clear internal state between unrelated audio segments
- [x] **Non-realtime mode** - Higher-quality algorithms for offline processing
- [x] **Plugin probe** - Get metadata without full instantiation
- [x] **Parameter text conversion** - Convert between normalized values and display strings
- [x] **Factory presets** - Access built-in plugin presets
- [x] **Sidechain support** - Multiple input bus configuration
- [x] **Bus layout queries** - Query plugin I/O topology
- [x] **Sample rate change** - Change sample rate without reloading, preserving parameter state
- [x] **Plugin scanning** - Discover plugins in a directory via `mh_scan_directory()`
- [x] **Double precision processing** - 64-bit audio processing via `mh_process_double()`
- [x] **Async plugin loading** - Background thread loading via `mh_open_async()`

## Planned

### High priority

- [x] **MIDI capability queries** - Expose `acceptsMidi()`, `producesMidi()`, `isMidiEffect()`, `supportsMPE()` on live plugin instances (currently only partial info via `MH_PluginDesc` at probe time)
- [x] **Parameter IDs** - Expose stable string IDs via `getParameterID()` for version-safe state management (integer indices can break if plugin reorders parameters)
- [x] **Parameter categories** - Expose `getCategory()` on parameters (frequency, dynamics, spatial, etc.) for organized display and programmatic filtering

### Medium priority

- [x] **Bus layout validation** - Expose `isBusesLayoutSupported()` / `canApplyBusesLayout()` to query valid configurations before attempting them
- [x] **Change notifications** - Expose `AudioProcessorListener` with `ChangeDetails` flags (latency changed, parameter info changed, program changed, bus layout changed) for reactive hosts
- [x] **Parameter gestures** - Expose `beginChangeGesture()` / `endChangeGesture()` so plugins can optimize behavior during automation drags
- [x] **Current program state** - Expose `getCurrentProgramStateInformation()` / `setCurrentProgramStateInformation()` for lighter-weight per-program state save/restore

### Lower priority

- [x] **Processing precision selection** - Expose `setProcessingPrecision()` to explicitly select float vs double mode
- [x] **Track properties** - Expose `updateTrackProperties()` to pass track name/color metadata to plugins

## Bugs

- [x] **Stale version assertion** - `test_minihost.py:225` asserts `__version__ == "0.1.1"` but package is at `"0.1.2"`
- [x] **Dead bit-depth detection in CLI** - `cli.py:820-824` tries `in_info.get("subtype", "")` but `get_audio_info()` no longer returns `subtype` (removed when miniaudio replaced soundfile in 0.1.2); always falls through to `bit_depth = 24`
- [x] **Incorrect docstring in render_midi_to_file** - `render.py:320` lists "FLAC, AIFF, OGG" as supported output formats but only WAV is supported

## Planned

### High priority

- [x] **Plugin chain automation** - Add `mh_chain_process_auto()` for sample-accurate automation across plugin chains (currently only single plugins support `mh_process_auto()`)
- [x] **FLAC write support** - `mh_audio_write()` supports FLAC output (16/24-bit) via vendored tflac encoder
- [ ] **OGG write support** - `mh_audio_write()` does not support OGG/Vorbis output; requires a vendored encoder
- [ ] **Expose audio input callback in Python** - Bind `mh_audio_set_input_callback` in `_core.cpp` to enable real-time effect processing from Python (e.g., guitar amp sims, live vocal processing)
- [x] **MIDI output in CLI play command** - `cmd_play` doesn't wire up MIDI output; instrument plugins that produce MIDI (arpeggiators, sequencers) silently drop it. Add a `--midi-out` flag

### Medium priority

- [ ] **CLI unit tests** - `cli.py` has six subcommands (`scan`, `info`, `params`, `midi`, `play`, `process`) with zero test coverage. At minimum test argument parsing and error paths
- [ ] **Render internals unit tests** - `_build_tempo_map`, `_tick_to_seconds`, `_collect_midi_events` in `render.py` are non-trivial pure-Python functions with no unit tests; edge cases (tempo changes mid-song, empty tracks, zero-duration notes) can silently produce wrong output
- [ ] **Offline bounce with tail detection** - `mh_get_tail_time()` exists but the render pipeline doesn't use it. Add auto-tail mode that keeps rendering until the plugin's tail decays below a threshold (useful for reverb/delay tails)

### Lower priority

- [ ] **Parameter preset morphing** - Higher-level Python utility for interpolating between two parameter snapshots (A/B morph) using `get_state`/`set_state` and per-parameter access
- [ ] **Async plugin loading in Python** - `mh_open_async()` exists in C but isn't bound in Python. An async/awaitable `Plugin.open_async()` would help with large sample-library plugins that take seconds to load

## Non-goals

Intentionally omitted for headless/server use:

- Editor window management
- GUI hosting
- Preset browser UI
- MIDI learn
- Plugin shell/multi-instrument handling
